===============================================================================

	86ボード PCM録音 補助Tools
						by M.Kajihara (KAJA)

===============================================================================

	86ボードや9821A/Cシリーズ内蔵音源で、PCMを録音する際に補助的に使うと
	便利なツール群を４つ、まとめてあります。

	以下に使用方法の説明を書きますが、あくまで補助的なツール群ですので、
	メインである録音と、PCMコンバート、PCM合成用に、T.KONO氏作のfswである、

HDPCM14 .LZH	(HDREC.COM / HDPLAY.COM)
PCONV18 .LZH	(PCMCONV.COM)
PMIX00  .LZH	(PCMMIX.COM)

	の３つが用意してある事を前提として説明します。

	また、使用されるPCMデータは、16bit PCM モノラル (.PHL)とします。

	理由は、
1)	PCMCONV がモノラルデータのみにしか対応していない。
2)	HDREC で録音出来る。
3)	PCMCONV で各種PCMデータにコンバートする際、もっとも音質劣化が少ない。
	の３点からです。

===============================================================================
	PCMCUT.COM
===============================================================================

	HDREC で録音した PCMFile (.PHL) を、実際に音が入っている部分のみ
	抽出する(前後の無音部分をＣＵＴする)ツールです。

	加工前のFileは、.ORG とリネームされます。
	既に、.ORG ファイルが存在する場合は、エラーになります。
	(削除してから実行して下さい。)

[Usage]
>PCMCUT [/Option] filename[.PHL]	拡張子は省略可

[Options]
/Vnum	無音と判断する最大電圧値 (デフォルト = 384 / $180)
	カットするべき電圧値(最大)を設定します。
	0〜±この数値 までがカットする対象となります。

/Hnum	電圧補正値(def=  +0)
	無音時の電圧が０になっていない場合(86Bで録音した場合システムによって
	若干偏ります)に、それを補正する値を指定します。
	総ての電圧値に指定数値を加算します。

	数値は、10進または "$" を付けて16進で表記します。
	符号が付く場合は、[±][$]数値 の順で表記します。

[使用例]
>>PCMCUT /V500 SD01
>Cut .PHL File Utility ( 最初と最後の小電圧部分削除 )
>                         Programmed by M.Kajihara 1994/04/13
>
>Cut Volume    : ±$01F4
>Start Address : $000050
>Stop  Address : $00B864
>ファイルを操作中です。
>終了しました。

[注意]
	頭の部分は、Cut Volume以上のデータが来た時点でカットしますが、
	お尻の部分は、最後のCut Volume以上の位置より前の、PCMDATAが最少となる
	箇所でカットされます。(発音後のノイズ軽減の為)

[例]
				    OVER
				    ↓↓		DATA終端
Cut.V+	________／＼________________／＼____________________|
              ／　　＼            ／　  ＼	      	    |
±0位置	----／--------＼--------／--------＼--------／＼／＼|
Cut.V-  __／____________＼____／____________＼____／________|
	／		　＼／		      ＼／	    |
					  ↑  ↑↑
					 ここ OVER
					 でCUT

	よって、何度も重ねてPCMCUTを掛けると、どんどん小さくなってしまう
	事がありますので注意して下さい。

===============================================================================
	PCMMAX.COM
===============================================================================

	.PHL Fileの、音量を自動的に最大まで引き上げるツールです。

	加工前のFileは、.ORG とリネームされます。
	既に、.ORG ファイルが存在する場合は、エラーになります。
	(削除してから実行して下さい。)

[Usage]
>PCMMAX filename[.PHL]		拡張子は省略可

[使用例]
>>PCMMAX SD01
>PHL file を最大音量まで上げる tool
>
>Peak = 29296 : UP率 = 286/256 : UP後Peak = 32729 で変換します。
>終了しました。

===============================================================================
	PCMPEAK.COM
===============================================================================

	PCMFile (.PHL) の 最大PEAK値と、
	PCMCONV でどの程度 音量を上げられるかを表示するツールです。

	前項のPCMMAX.COMで簡単に最大までは上げられますが、例えば最大より
	ちょっと小さい程度の音量にしたいといった場合に利用します。

[Usage]
>PCMPEAK filename[.PHL]		拡張子は省略可

[使用例]
>>PCMPEAK SD01
>PHL fileの 電圧peak値を検索表示するtool
>
>Peak は 29296 です。
>PCMCONV(c)T.K で 286 まで上げられます。

	の場合は、

>PCMCONV 286 /H SD01 /H SD01UP

	とすると最大音量になります。

===============================================================================
	PCMSHAPE.COM
===============================================================================

	人の声などをサンプリングした.PHL Fileの、小電圧部分(音が小さい部分)を
	ゼロクリアし、LHA等での圧縮時に、より圧縮が掛かるように加工するツール
	です。

	PCMCUT.COMでは前後をCUTしますが、これを小電圧部分であれば真ん中でも
	どこでもゼロにクリアするようにしたものと考えて下さい。

	前後はCUTしないので、場合によっては実行後にPCMCUTも実行した方が
	良いでしょう。

	このツールは、扱うPCMソースによっては全く使わないので、いわゆる
	オマケです(^^;。

[Usage]
>PCMSHAPE [/options] filename[.phl]

[Options]
/Vnum	最低電圧値(±)      (def= 384)
	ゼロクリアするべき電圧値(最大)を設定します。
	0〜±この数値 までがゼロクリアする対象となります。

/Lnum	最短クリア範囲(WORD)(def= 256)
	上の数値範囲がどの程度続けば、ゼロクリアするかどうかを設定します。
	デフォルトでは、０〜±３８４が、２５６ワード(512bytes)以上続けば、
	その間を総て０にクリアします。

/H±num	電圧補正値          (def=  +0)
	無音時の電圧が０になっていない場合(86Bで録音した場合システムによって
	若干偏ります)に、それを補正する値を指定します。
	総ての電圧値に指定数値を加算します。

	数値は、10進または "$" を付けて16進で表記します。
	符号が付く場合は、[±][$]数値 の順で表記します。

[使用例]
>>PCMSHAPE /V1024 /L128 VOICE08.PHL
>Shape UP .PHL File Utility ( 小電圧部分ゼロクリア )
>                         Programmed by M.Kajihara 1994/04/13
>
>最低電圧値     : ±1024
>最短クリア範囲 :   128 Words
>クリア箇所数   :   8 箇所
>終了しました。

===============================================================================
	実際の使用例
===============================================================================
	もっとも高音質のPCMデータを作成するためには、
	以下の手順を踏むとベストになります。

1.	HDREC で録音する (モノラル、可能な限り高周波数(44.1KHzがベスト)で)
2.	必要に応じて PCMMAXで音量を上げる
3.	PCMCUTで無音部分をCUTする
4.	HDPLAY で確認する。問題があれば 1.に戻る
5.	必要に応じて PCMMIX で他のPCMデータとMIXする
6.	PCMCONV で目的のPCMデータ、周波数に変換する

	1.〜4.までは、以下のようなバッチを作成して一度にやると便利です。
-[REC.BAT]---------------------------------------------------------------------
echo off
pause					<- KEY入力待ち
hdrec /w /o0 /f0 %1			<- /f0 は好みによって変更
if exist %1.org del %1.org
pcmmax %1				<- 音量を上げなくていい場合は要らない
del %1.org				<- 同上
pcmcut /$300 %1				<- $300は好みによって変更
del %1.org
hdplay /w /f0 %1.phl			<- /f0 は好みによって変更
-------------------------------------------------------------------------------

	MIX等をしないで、決まったPCMデータにコンバートする時は、
	バッチの最後にコンバートするようにすると良いでしょう。

-[REC.BAT追加例]---------------------------------------------------------------
	:
pcmconv /h %1 44100 /a %1 16000		<- .PHL 44.1KHz から .SPB 16KHzに変換
-------------------------------------------------------------------------------

===============================================================================
			---- End of PCMUTIL.DOC ----
===============================================================================
