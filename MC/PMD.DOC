===============================================================================

	---- Ｐ.Ｍ.Ｄ.98/88VA Version 4.8 Document ----

							By M.Kajihara(KAJA)

===============================================================================
	はじめに
-------------------------------------------------------------------------------

	PMDはPC98/PC88/PC88VA/X68000/FM-TOWNS/IBMPC用の音楽ドライバです。
	ここでは、PC98/88VA版についての詳細を記します。

	PMDはＦＭ音源でMMLによって曲を作成し、演奏する事を第一目的とした
	プログラムで、他にも効果音、ポーズ、フェードイン・アウト等、
	特にゲーム等に組み込むのに適した機能に優れています。

	ドライバは使用するソフトによって常駐量を最低限まで減らすために、
	音源によってそれぞれ分かれています。

	現在対応している音源及びそれに対応するドライバは、

1)	YM2203		(PMD.COM or PMDVA1.COM)
	PC-9801DA等に内蔵の音源
	PC-9801-26K(互換)ボード
	PC88VA1の内蔵音源
	Sound Blaster + YM2203option

2)	YM2608単体	(PMDB2.COM)
	PC98DO+/GSに標準装備の音源
	"ＡＳＢ"
	PC-9821X,Cシリーズ中の PCMにWSSを使用している音源

3)	YM2608+ADPCM	(PMDB2.COM or PMDVA.COM)
	"スピークボード"
	"音美ちゃん"のYM2608部
	PC-9801-86または PC9821A,Cシリーズに搭載されている音源＋"ちびおと"
	PC88VA2/3の内蔵音源

4)	YM2608+PCM	(PMD86.COM or PMDPPZ.COM)
	PC-9801-86または PC9821Aシリーズ及びCシリーズの一部に搭載されている音源
	[ 別途 PPZ8 があれば PCM8声の再生が可能(PMDPPZ) ]

5)	YMF288+WSSPCM	(PMDPPZ.COM)
	PC-9801-118または CanBeシリーズ内蔵音源
	[ 別途 PPZ8 があれば PCM8声の再生が可能(PMDPPZ) ]

	の５種類です。

===============================================================================
	環境変数について
-------------------------------------------------------------------------------
	環境変数は、PMDシステム全体として、

	PMD=		(PMP/MC/MCH 他FILEを扱うユーティリティの総て)
	PMDOPT=		(PMD/B2/VA/VA1/86/PPZ.COM)
	COMPOSER=	(MC/MCH)
	ARRANGER=	(MC/MCH)
	USER=		(MC/MCH)
	MCOPT=		(MC/MCH)

	の６つを使用します。目的によって各自適宜に設定して下さい。

	詳細は各ユーティリティのマニュアルを参照して下さい。

===============================================================================
	使用説明
-------------------------------------------------------------------------------
	PMD/B2/VA/VA1/86/PPZ.COMは、音楽ドライバ本体となり、
	常駐すると音楽演奏その他メイン処理を司ります。

	実行すると、

・	常駐していない状態で、/R、/Hオプションが指定されていなかった場合は、
	常駐します。

・	既に常駐されている場合は、再設定が可能なオプションを再設定処理した後、
	現在の設定状態を表示します。

・	/Rオプションが指定されていると、常駐を解除します。

	環境変数 "PMDOPT=" が定義されていると、実行毎に自動的に
	定義されている文字列をオプションとして追加します。
	ただし、コマンドラインに同じオプションが指定されている場合は、
	コマンドラインのものが優先されます。

	オプションは以下の物が使用出来ます。（nは数値を現します。）

-------------------------------------------------------------------------------
	常駐時にのみ使用出来るオプション
-------------------------------------------------------------------------------
/Mn
	演奏出来る曲データの最大サイズを 1KB 単位で指定します。
	デフォルトは 16 で、 16384 bytes (16KB)までの曲データが演奏出来ます。
	これ以上大きな曲データを演奏させたい時は、大きな値を指定して下さい。
	例えば 24000 bytesの曲を演奏させるには、最低 /M24 と、オプションを
	指定する必要があります。
	最小サイズは 1KBで、0KBにする事は出来ません。

/Vn
	音色データの最大サイズを 1KB 単位で指定します。
	デフォルトは最大の 8KB です。この領域は主に曲作成時に使用されます
	ので、演奏だけに使用する時は、殆どの場合 /V0 として領域を確保しない
	でも大丈夫です。
	但し、MC(H).EXE を使用する時は、必ずデフォルトの 8KB を確保する
	ようにして下さい。

/En
	ＦＭ音源効果音データの最大サイズを 1KB 単位で指定します。
	デフォルトは 4KB ですが、fsw版ではＦＭ音源効果音は作成出来ませんので、
	/E0 として領域を確保しなくても何等問題は出ません。
	よって、曲データ鑑賞にのみPMDを使用する方は、
>PMD?? /M24 /V0 /E0
	とすると常駐サイズが減る上、演奏出来る曲データ長も大きくなりますので、
	バッチか、環境変数"PMDOPT="でこのように常駐するようにしておくと
	良いかと思います。

!注意!	/Mn と /Vn と /En の指定値の合計の最大は、40(KB)です。

/On
	使用するＦＭ音源ポートを選択します。
	デフォルトでは、
1.	ADPCM-RAM付きYM2608	(PMD86の場合は PCM付き YM2608)
2.	YM2608
3.	YM2203
	の順に検索し、見つけた所を使用します。
	同じ音源が２枚以上刺さっていた場合は若いポート番号が選択されます。

	188Hに SPB が刺さっている状態で、 088Hのノーマル音源を使用したいと
	いった場合は、 >PMD /O0 とこのオプションを指定して下さい。

-------------------------------------------------------------------------------
	常駐時に設定、又は常駐後に再設定が可能なオプション
-------------------------------------------------------------------------------
/DFn
/DSn
/DPn	(PMDB2/VA/86/PPZ.COM専用)
/DRn	(PMDB2/VA/86/PPZ.COM専用)
/DZn	(PMDPPZ.COM専用)
	/DFはＦＭ音源、
	/DSはＳＳＧ音源、
	/DPは(AD)PCM音源、
	/DRはリズム音源
	/DZはPCM音源(PPZ8部分)
	をそれぞれ表し、各音源での音量のバランスを調整する為に、各どれだけ
	音量を下げるかを数値で指定します。

	0〜255の指定が可能で、大きい程音量が小さくなります。
	例えばNEC機とEPSON機ではＦＭとＳＳＧの音量バランスが顕著に
	違っていたりするといった事が多くありますので、それらの調整に
	使用して下さい。
	デフォルトでは PMD.COM の /DFのみ 16、その他は全て0です。
	この数値は曲データによっても局所的に変更される場合があります。

/N(-)	(PMDB2/VA/86/PPZ.COM専用)
	・/N が指定されていた場合(常駐時／常駐後共)
	　K/Rパートで演奏されるSSGドラムと同時にリズム音源を鳴らしません。
	・/N-が指定されていた場合(常駐時／常駐後共)
	　K/Rパートで演奏されるSSGドラムと同時にリズム音源を鳴らします。
	・何も指定しなかった場合(常駐時のみ)
	　PPSDRVが常駐していれば、/N、PPSDRVが常駐していなければ、/N-
	　オプションが指定されているのと同じになります。

/P(-)
	・/P が指定されていた場合(常駐時／常駐後共)
	　PPSDRVには対応しません。
	・/P-が指定されていた場合(常駐時／常駐後共)
	　PPSDRVが常駐していれば、対応します。
	・何も指定しなかった場合(常駐時のみ)
	　/P-と同様です。

/K(-)
	ESC/GRPH入力による 曲の停止/早送り/巻き戻し を抑制します。
	PMDには、ESCキーで曲の停止、GRPHキーで早送り/巻き戻しをする機能が
	ありますが、そのままではゲーム等に組み込む際には不都合ですので、
	このオプションを指定するようにして下さい。
	/K- とすると、デフォルトの状態に戻します。
!注意!	PMDPCM.EXEの/B オプション指定時に、PCMを定義又は読みだしをしている時は
	ESC/GRPHの機能は働きません。(ESCの曲停止でのPCM停止を回避する為)

/KEn
/KGn
/KRn
	ESC/GRPHでの曲停止/早送り/巻き戻しで、同時に押さなければ動作しない
	ようにする特殊キーを指定します。
	/KE は ESC、/KG は GRPH(早送り)、/KR は GRPH(巻き戻し)について、
	(98)	0=無し 1=SHIFT 2=CAPS  4=ｶﾅ   8=GRPH 16=CTRL
	(VA)	0=無し 1=ｶﾅ    2=SHIFT 4=CTRL
	を同時入力キーとして定義します。
	例えば、 PMD.COMで/KG1 と指定すると、早送りは SHIFT+GRPH となります。
	２つ以上加算した値も指定可能です。(例:/KE17 =曲の停止は CTRL+SHIFT+ESC)
	デフォルトでは、
	/KE /KGが CTRL キー(16または4)
	/KR    が SHIFTキー( 1または2)
	が指定されています。
	どれか一つの機能を抑制したいといった場合は、ここで指定する値を
	255 として下さい。

/F(-)
	フェードアウト終了時に曲の演奏を停止しません。
	デフォルトでは停止します。
	ゲーム等に組み込む際、Fadeout後にFadeinさせたいといった場合に
	指定して下さい。
	/F- とすると、デフォルトの状態に戻します。

/I(-)
	ＦＭ音源割り込み中に、他の割り込みを禁止するように設定します。
	デフォルトでは許可します。
	他のTSRと相性が悪い場合、特に重いTSRを載せていて曲が遅くなってしまう
	といった場合に指定してみて下さい。
	/I- とすると、デフォルトの状態に戻します。

/Wn
	FM音源のRegister出力 -> Data出力までの Wait値を設定します。
	省略すると、音源によって、適当なWaitが入るように自動設定されます。
	値が小さくなる程 ドライバが軽くなり、音源が不安定になります。
	通常はデフォルトのままにしておくのが無難です。
	デフォルトより大きくしないとおかしくなる場合は是非ご一報下さい。
	次からはその環境でもデフォルトで動作するように善処したいと思います。

/Gn
	GRPHキーによる早送り時のテンポ（TimerB値）を1〜255の範囲で設定します。
	デフォルトは 250 が設定されています。
	値を大きくすればそれだけ速くなりますが、遅い機種ではハングアップする
	可能性がありますので注意してください。

/A(-)	(PMDB2/VA/PPZ.COM専用)
	ADPCM定義時に、waitを挿入して安定した動作を保証します。
	ADPCM定義がうまくいかない場合に指定してみて下さい。
	ゲーム等に組み込む際は指定しておいた方が良いでしょう。
	/A-と指定するとデフォルトの高速定義モードに戻します。

/S(-)	(PMD86.COM専用)
	PCMの仕様をADPCMになるべく合わせるようにします。
	PMDB2/VA用の曲のPCMを変換してPMD86で演奏する際に使用して下さい。
	具体的には以下の調整を行います。
1)	PCMパートの音量を、PMDB2におけるADPCMの音量に補正します。
2)	PCMパートのデチューンが効かなくなります。
	(ADPCM時のDETUNE値の反映と大幅に異なってしまう為)
3)	PCM音色のループ制御がADPCMに合わせて32byte単位に補正されます。
4)	o7e以上の音程を再生出来ないようにします。(オクターブを下げます)

	/S-オプションを指定すればPMD86本来の仕様に戻ります。
	また、この仕様は曲データによっても局所的に変更される場合があります。

-------------------------------------------------------------------------------
	常駐後にのみ指定可能なオプション
-------------------------------------------------------------------------------
/R
	常駐を解除します。解除出来ない場合は、PMDより後に常駐させた常駐物を
	解除して下さい。

-------------------------------------------------------------------------------
	いつでも使用可能なオプション
-------------------------------------------------------------------------------
/H
	オプション一覧を表示します。
	コマンドラインにおかしな文字列があった場合もこれと同様になります。

===============================================================================
--------Exsamples
-------------------------------------------------------------------------------

>pmd
	98,OPN用のPMDを 常駐します。

>pmd /r
	98,OPN用のPMDを 常駐解除します。

>pmdb2 /v0 /e0 /m32 /k
	音色／ＦＭ効果音各データエリアを確保せず、曲データバッファを32KB確保し､	さらにESC/GRPH入力を無効にして、98,OPNA用のドライバを常駐します。

(常駐後)
>pmdb2 /k-
	無効にしたESC/GRPHの機能を有効に戻します。

===============================================================================
	ウイルス混入チェック機構について
-------------------------------------------------------------------------------

	PC98版のPMDxx.COMには、ウイルス混入のチェック機構が付いています。
	実際には実行直後に自分自身をチェックして、サイズなどが変更されて
	いた場合に警告が表示されます。

	ですから、DIET/PKLITE/LZEXE などで実行ファイルが圧縮されている場合にも
	これに引っ掛かってしまい、警告が表示されてしまいますので注意して下さい｡

	また、このチェック機構の構造上、実行ファイルがリネームされていると、
	チェックが行えなくなってしまいますので、そういった場合には、注意文が
	表示されます。

	これらは、MS-DOSの非公開機能,情報を使ってチェックを施していますので、
	ゲームに組み込む際など、オリジナルのDOSを使っていた場合にも警告/注意が
	表示されてしまう場合があります。

	実際には表示されても（本物のウイルスさえ混入していなければ）動作には
	全く支障はありませんが、この表示が気になる場合は、オプション文字列の
	頭に # 記号を付加することによって、チェック機構をスキップします。

	但し、必ず、実際のコマンドラインに指定する必要があります。
	環境変数 PMDOPT= でその指定をする事は出来ません。

(例)
A:\>PMD #/m24/v0/e2/k

	ウイルスチェックをスキップしてPMDを常駐します。

===============================================================================
	Windows子プロセスでの実行について
-------------------------------------------------------------------------------
	Windows MS-DOSプロンプトでの動作では、以下の機能が働きません。

1)	CPUPower判別

	/w[数値]の自動設定の事です。

	Windows下では、デフォルトではかなり大きな値を設定してしまいますので、
	必然的にドライバが必要以上に重くなってしまいます。

	一度DOS環境下で常駐し、/w値が自動でいくつに判定されたかを確認し、
	バッチなどで/w値を指定してあげると良いでしょう。

	ただし、別に重くてもかまわないという事でしたら、注意する必要は
	ありません。

2)	ウイルスチェック機構

	完全にスキップします。

===============================================================================
	注意点
===============================================================================

	PC-386GE / PC-386GS の２機種の初期ロットで、演奏中、Floppy DISKの
	読み込みが遅くなる(リトライを繰り返す)といった症状が
	報告されています。これはDISK-BIOSのバグらしく、２期ロットからは大丈夫な
	ようですので、EPSONに相談してみて下さい。

	ただし、未確認ですが、以上のような環境でも動作するように努力改良は
	行っていますので、以上の機種、音源で正常または異常動作した際には
	ご一報頂ければ幸いです。

===============================================================================

	各種質問、バグレポート、その他は、PMDBBS/東京BBSの ID:KAJA までMAILか、
	下記のＰＭＤサポートボードにて書込みをお願いします。

PMD-BBS		@PMD	PMDサポートボード
同人Network	@DRY	緑水Software&PMDのボード (東京BBSからGatewayで飛べます)

	また、README.1STの最後に私の住所/TELが書いてあります。質問等は
	TELでお気軽にどうぞ。郵便では多忙で返せない場合がありますので
	NETに入る方法が無い方は、なるべくTELかFAXでお願いします。

===============================================================================
			  ---- End of PMD.DOC ----
===============================================================================
